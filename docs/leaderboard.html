<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leaderboard | The Amatour</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <div id="header"></div>
  <main class="max-w-5xl mx-auto px-6 py-10">
    <h1 class="text-4xl font-bold mb-4">üèÜ Season Leaderboard</h1>

    <p class="text-lg text-gray-700 mb-6">
      View current rankings and participation across all 2025 Amatour events. Click any column header to sort or use the search box to filter players.
    </p>

    <!-- üîç Search -->
    <div class="mb-6">
      <label for="search" class="block text-sm font-medium text-gray-700 mb-1">Search by Player Name:</label>
      <input
        type="text"
        id="search"
        oninput="filterTableBySearch()"
        placeholder="Type a name..."
        class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
      />
    </div>

    <!-- üßæ Leaderboard Table -->
    <div class="overflow-x-auto rounded-lg shadow-sm bg-white">
      <table id="leaderboard" class="min-w-full text-sm text-left text-gray-700">
        <thead class="bg-gray-100 text-xs uppercase tracking-wider text-gray-600">
          <tr>
            <th class="px-6 py-4 cursor-pointer" onclick="sortLeaderboard(0)">Player <span data-icon="0"></span></th>
            <th class="px-6 py-4 cursor-pointer" onclick="sortLeaderboard(1)">Finale Points <span data-icon="1"></span></th>
            <th class="px-6 py-4 cursor-pointer" onclick="sortLeaderboard(2)">Purchase Points <span data-icon="2"></span></th>
            <th class="px-6 py-4 cursor-pointer" onclick="sortLeaderboard(3)">Events Played <span data-icon="3"></span></th>
            <th class="px-6 py-4 cursor-pointer" onclick="sortLeaderboard(4)">Net Wins <span data-icon="4"></span></th>
            <th class="px-6 py-4 cursor-pointer" onclick="sortLeaderboard(5)">Gross Wins <span data-icon="5"></span></th>
            <th class="px-6 py-4 cursor-pointer" onclick="sortLeaderboard(6)">Raffle Count <span data-icon="6"></span></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <div id="footer"></div>

  <!-- üîß Sort & Search Script -->
  <script>
    let sortState = { column: 0, ascending: true };
    let playerData = [];
  
    // üó∫Ô∏è Column index to data key
    const columnKeyMap = {
      0: "name",
      1: "finale_points",
      2: "purchase_points",
      3: "events_played",
      4: "net_wins",
      5: "gross_wins",
      6: "raffle_count"
    };
  
    // üîÅ Load leaderboard data
    async function loadLeaderboardData() {
      try {
        const response = await fetch('./statistics/overview.json');
        playerData = await response.json();
        renderTable(playerData);
        sortLeaderboard(0); // default sort by Player
      } catch (error) {
        console.error('Error loading leaderboard data:', error);
      }
    }
  
    // üß± Render table rows
    function renderTable(data) {
      const tbody = document.querySelector("#leaderboard tbody");
      tbody.innerHTML = "";
  
      data.forEach(player => {
        const row = document.createElement("tr");
        row.className = "border-b hover:bg-indigo-50 cursor-pointer transition";
        row.onclick = () => window.location.href = `./player-details.html?player=${player.slug}`;
  
        row.innerHTML = `
          <td class="px-6 py-4 font-medium text-indigo-600">${player.name}</td>
          <td class="px-6 py-4">${player.finale_points}</td>
          <td class="px-6 py-4">${player.purchase_points}</td>
          <td class="px-6 py-4">${player.events_played}</td>
          <td class="px-6 py-4">${player.net_wins}</td>
          <td class="px-6 py-4">${player.gross_wins}</td>
          <td class="px-6 py-4">${player.raffle_count}</td>
        `;
        tbody.appendChild(row);
      });
    }
  
    // üîÉ Sorting
    function sortLeaderboard(colIndex) {
      const key = columnKeyMap[colIndex];
      if (!key) return;

      // Anytime column index is changed we default to asc
      if (sortState.column !== colIndex) {
        sortState.ascending = true;
      }
  
      const isNumber = typeof playerData[0][key] === "number";
  
      const sortedData = [...playerData].sort((a, b) => {
        const aVal = a[key];
        const bVal = b[key];
  
        if (isNumber) {
          return sortState.ascending ? aVal - bVal : bVal - aVal;
        } else {
          return sortState.ascending
            ? String(aVal).localeCompare(String(bVal))
            : String(bVal).localeCompare(String(aVal));
        }
      });
  
      renderTable(sortedData);
  
      if (sortState.column === colIndex) {
        sortState.ascending = !sortState.ascending;
      } else {
        sortState.column = colIndex;
        sortState.ascending = true;
      }
  
      document.querySelectorAll("span[data-icon]").forEach(span => span.innerText = "");
      const iconTarget = document.querySelector(`span[data-icon="${colIndex}"]`);
      if (iconTarget) iconTarget.innerText = sortState.ascending ? "‚ñ≤" : "‚ñº";
    }
  
    // üîç Filtering
    function filterTableBySearch() {
      const query = document.getElementById("search").value.toLowerCase();
      const filtered = playerData.filter(player =>
        player.name.toLowerCase().includes(query)
      );
      renderTable(filtered);
    }
  
    // üß© Inject header/footer & add mobile toggle
    async function loadPartial(id, file) {
      const res = await fetch(file);
      const html = await res.text();
      document.getElementById(id).innerHTML = html;
  
      // Attach toggle handler if this is the header
      if (id === "header") {
        const toggle = document.getElementById("menu-toggle");
        const menu = document.getElementById("mobile-menu");
        if (toggle && menu) {
          toggle.addEventListener("click", () => {
            menu.classList.toggle("hidden");
          });
        }
      }
    }
  
    // üöÄ Init on page load
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("search").addEventListener("input", filterTableBySearch);
      loadLeaderboardData();
      loadPartial("header", "./shared/header.html");
      loadPartial("footer", "./shared/footer.html");
    });
  </script>
</body>
</html>
