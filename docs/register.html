<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Register | The Amatour</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <div id="header"></div>

  <main class="max-w-2xl mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold text-indigo-700 mb-4">Join The Amatour</h1>
    <p class="text-gray-700 mb-6">
      The Amatour is a competitive and fun golf league that welcomes all skill levels. Whether you're chasing birdies or just here for the vibes, you'll find a community of golfers who are just like you. By joining, you'll gain access to events, rankings, and prize winnings.
    </p>

    <a
      href="https://docs.google.com/forms/d/e/1FAIpQLSfwVmR5VAx25Wlo-09cIPtOkNB6Z85CQwNXCuYzS5Fl6Cggxg/viewform?usp=header"
      target="_blank"
      class="inline-block bg-indigo-600 text-white px-6 py-3 rounded-md text-sm font-medium hover:bg-indigo-700 transition">
      Register
    </a>
  </main>

  <div id="footer"></div>

  <script>
    async function loadPartial(id, file) {
        const res = await fetch(file);
        const html = await res.text();
        document.getElementById(id).innerHTML = html;

        // Attach menu toggle behavior *after* header is injected
        // Re-run script after loading header
        if (id === "header") {
          const toggleButton = document.getElementById("menu-toggle");
          const menu = document.getElementById("mobile-menu");

          toggleButton?.addEventListener("click", (e) => {
            e.stopPropagation();
            menu?.classList.toggle("hidden");
          });

          document.addEventListener("click", (e) => {
            if (!menu?.contains(e.target) && !toggleButton?.contains(e.target)) {
              menu?.classList.add("hidden");
            }
          });
        }
      }

    // const checkbox = document.getElementById("agreeRules");
    // const button = document.getElementById("registerButton");

    // checkbox.addEventListener("change", () => {
    // if (checkbox.checked) {
    //     button.disabled = false;
    //     button.classList.remove("bg-indigo-400", "opacity-50", "cursor-not-allowed");
    //     button.classList.add("bg-indigo-600", "hover:bg-indigo-700");
    // } else {
    //     button.disabled = true;
    //     button.classList.remove("bg-indigo-600", "hover:bg-indigo-700");
    //     button.classList.add("bg-indigo-400", "opacity-50", "cursor-not-allowed");
    // }
    // });


    loadPartial("header", "./shared/header.html");
    loadPartial("footer", "./shared/footer.html");

    // Load referral options from active-members.json
    let validReferrals = [];

    fetch("./active-members.json")
        .then(res => res.json())
        .then(data => {
        validReferrals = data.sort((a, b) => a.localeCompare(b));
        const referralList = document.getElementById("referralOptions");
        validReferrals.forEach(name => {
            const option = document.createElement("option");
            option.value = name;
            referralList.appendChild(option);
        });
        });

    document.getElementById("registerButton").addEventListener("click", (e) => {
        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const handicap = document.getElementById("handicap").value.trim();
        const referral = document.getElementById("referral").value.trim();
        const agree = document.getElementById("agreeRules").checked;
        const errorBox = document.getElementById("formError");
        const successBox = document.getElementById("formSuccess");

        errorBox.textContent = "";
        successBox.textContent = "";

        if (!name || !email || !handicap || !referral || !agree) {
        errorBox.textContent = "Please complete all fields and agree to the rules.";
        return;
        }

        if (!validReferrals.includes(referral)) {
        errorBox.textContent = "Referral name must match a current member from the list.";
        return;
        }

        const body = `Hi, I'd like to register for The Amatour. Here are my details:\n\nName: ${name}\nEmail: ${email}\nHandicap: ${handicap}\nReferred By: ${referral}`;
        const mailto = `mailto:info.theamateurstour@gmail.com?subject=New Registration&body=${encodeURIComponent(body)}`;

        // NEW (robust way to trigger email client)
        const tempLink = document.createElement("a");
        tempLink.href = mailto;
        tempLink.style.display = "none";
        document.body.appendChild(tempLink);
        tempLink.click();
        document.body.removeChild(tempLink);

        successBox.textContent = "Thank you for registering! Please check your email to send the message.";
        document.getElementById("registerForm").reset();
        document.getElementById("registerButton").disabled = true;

        setTimeout(() => {
        document.getElementById("registerButton").disabled = false;
        }, 3000);
    });
  </script>
</body>
</html>
