<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Register | The Amatour</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <div id="header"></div>

  <main class="max-w-2xl mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold text-[#03072D] mb-4">Join The Amatour</h1>
    <p class="text-gray-700 mb-6">
      The Amatour is a competitive and fun golf league that welcomes all skill levels. Whether you're chasing birdies or just here for the vibes, you'll find a community of golfers who are just like you. By joining, you'll gain access to events, rankings, and prize winnings.
    </p>

    <section aria-labelledby="registrationHeading" class="mt-4">
        <h2 id="registrationHeading" class="sr-only">Registration actions</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <a
            href="https://docs.google.com/forms/d/e/1FAIpQLSfwVmR5VAx25Wlo-09cIPtOkNB6Z85CQwNXCuYzS5Fl6Cggxg/viewform?usp=header"
            target="_blank"
            rel="noopener noreferrer"
            class="group block bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition focus:outline-none focus:ring-2 focus:ring-indigo-300"
            aria-labelledby="newRegTitle newRegDesc"
          >
            <div class="flex items-start gap-3">
              <div class="flex-none">
                <!-- simple icon -->
                <svg class="w-8 h-8 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M12 4v16M4 12h16" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center justify-between gap-2">
                  <h3 id="newRegTitle" class="text-sm font-semibold text-gray-800">New Registration</h3>
                  <span class="inline-flex items-center text-xs font-medium bg-indigo-50 text-indigo-700 px-2 py-0.5 rounded">First time</span>
                </div>
                <p id="newRegDesc" class="text-xs text-gray-500 mt-1">Sign up as a new player. Provide basic info and handicap when prompted.</p>
              </div>
            </div>
          </a>
      
          <a
            href="https://docs.google.com/forms/d/e/1FAIpQLSf6lSyS-FOJr5YE7IMH9YvHF_sGD3XWbyGGEGnC3VD72HBYXw/viewform?usp=header"
            target="_blank"
            rel="noopener noreferrer"
            class="group block bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition focus:outline-none focus:ring-2 focus:ring-indigo-300"
            aria-labelledby="returnRegTitle returnRegDesc"
          >
            <div class="flex items-start gap-3">
              <div class="flex-none">
                <svg class="w-8 h-8 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M20 12H4M14 6l-6 6 6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center justify-between gap-2">
                  <h3 id="returnRegTitle" class="text-sm font-semibold text-gray-800">Returning Registration</h3>
                  <span class="inline-flex items-center text-xs font-medium bg-green-50 text-green-700 px-2 py-0.5 rounded">Returning</span>
                </div>
                <p id="returnRegDesc" class="text-xs text-gray-500 mt-1">For players returning for the 2026 season, provide details and feedback in the form.</p>
              </div>
            </div>
          </a>
        </div>
      </section>
  </main>

  <div id="footer"></div>

  <script>
    async function loadPartial(id, file) {
        const res = await fetch(file);
        const html = await res.text();
        document.getElementById(id).innerHTML = html;

        // Attach menu toggle behavior *after* header is injected
        // Re-run script after loading header
        if (id === "header") {
          const toggleButton = document.getElementById("menu-toggle");
          const menu = document.getElementById("mobile-menu");

          toggleButton?.addEventListener("click", (e) => {
            e.stopPropagation();
            menu?.classList.toggle("hidden");
          });

          document.addEventListener("click", (e) => {
            if (!menu?.contains(e.target) && !toggleButton?.contains(e.target)) {
              menu?.classList.add("hidden");
            }
          });
        }
      }

    // const checkbox = document.getElementById("agreeRules");
    // const button = document.getElementById("registerButton");

    // checkbox.addEventListener("change", () => {
    // if (checkbox.checked) {
    //     button.disabled = false;
    //     button.classList.remove("bg-indigo-400", "opacity-50", "cursor-not-allowed");
    //     button.classList.add("bg-indigo-600", "hover:bg-indigo-700");
    // } else {
    //     button.disabled = true;
    //     button.classList.remove("bg-indigo-600", "hover:bg-indigo-700");
    //     button.classList.add("bg-indigo-400", "opacity-50", "cursor-not-allowed");
    // }
    // });


    loadPartial("header", "./shared/header.html");
    loadPartial("footer", "./shared/footer.html");

    // Load referral options from active-members.json
    let validReferrals = [];

    fetch("./active-members.json")
        .then(res => res.json())
        .then(data => {
        validReferrals = data.sort((a, b) => a.localeCompare(b));
        const referralList = document.getElementById("referralOptions");
        validReferrals.forEach(name => {
            const option = document.createElement("option");
            option.value = name;
            referralList.appendChild(option);
        });
        });

    document.getElementById("registerButton").addEventListener("click", (e) => {
        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const handicap = document.getElementById("handicap").value.trim();
        const referral = document.getElementById("referral").value.trim();
        const agree = document.getElementById("agreeRules").checked;
        const errorBox = document.getElementById("formError");
        const successBox = document.getElementById("formSuccess");

        errorBox.textContent = "";
        successBox.textContent = "";

        if (!name || !email || !handicap || !referral || !agree) {
        errorBox.textContent = "Please complete all fields and agree to the rules.";
        return;
        }

        if (!validReferrals.includes(referral)) {
        errorBox.textContent = "Referral name must match a current member from the list.";
        return;
        }

        const body = `Hi, I'd like to register for The Amatour. Here are my details:\n\nName: ${name}\nEmail: ${email}\nHandicap: ${handicap}\nReferred By: ${referral}`;
        const mailto = `mailto:info.theamateurstour@gmail.com?subject=New Registration&body=${encodeURIComponent(body)}`;

        // NEW (robust way to trigger email client)
        const tempLink = document.createElement("a");
        tempLink.href = mailto;
        tempLink.style.display = "none";
        document.body.appendChild(tempLink);
        tempLink.click();
        document.body.removeChild(tempLink);

        successBox.textContent = "Thank you for registering! Please check your email to send the message.";
        document.getElementById("registerForm").reset();
        document.getElementById("registerButton").disabled = true;

        setTimeout(() => {
        document.getElementById("registerButton").disabled = false;
        }, 3000);
    });
  </script>
</body>
</html>
