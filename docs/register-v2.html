<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Register | The Amatour</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <div id="header"></div>

  <main class="max-w-2xl mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold text-indigo-700 mb-4">Join The Amatour</h1>
    <p class="text-gray-700 mb-6">
      The Amatour is a competitive and fun golf league that welcomes all skill levels. Whether you’re chasing birdies or just here for the vibes, you’ll find a community of golfers who are just like you. By joining, you’ll gain access to exclusive events, rankings, and prize winnings.
    </p>

    <a
      href="https://docs.google.com/forms/d/e/1FAIpQLSfwVmR5VAx25Wlo-09cIPtOkNB6Z85CQwNXCuYzS5Fl6Cggxg/viewform?usp=header"
      target="_blank"
      class="inline-block bg-indigo-600 text-white px-6 py-3 rounded-md text-sm font-medium hover:bg-indigo-700 transition">
      Register
    </a>
    
    <form id="registerForm" class="space-y-4">
      <!-- Name -->
        <div class="mb-5">
            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
            <input type="text" id="name" name="name"
            class="w-full rounded-2xl border border-gray-300 px-4 py-2 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 focus:ring-2 focus:outline-none transition"
            placeholder="Your full name" required>
        </div>
        
        <!-- Email -->
        <div class="mb-5">
            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
            <input type="email" id="email" name="email"
            class="w-full rounded-2xl border border-gray-300 px-4 py-2 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 focus:ring-2 focus:outline-none transition"
            placeholder="you@example.com" required>
        </div>
        
        <!-- Handicap -->
        <div class="mb-5">
            <label for="handicap" class="block text-sm font-medium text-gray-700 mb-1">Handicap</label>
            <input type="text" id="handicap" name="handicap"
            class="w-full rounded-2xl border border-gray-300 px-4 py-2 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 focus:ring-2 focus:outline-none transition"
            placeholder="e.g. 12" required>
        </div>
        
        <!-- Referral (with search) -->
        <div class="mb-5">
            <label for="referral" class="block text-sm font-medium text-gray-700 mb-1">Referred By</label>
            <input list="referralOptions" id="referral" name="referral"
            class="w-full rounded-2xl border border-gray-300 px-4 py-2 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 focus:ring-2 focus:outline-none transition"
            placeholder="Start typing a name..." />
            <datalist id="referralOptions"></datalist>
        </div>
        <p id="formError" class="text-red-600 text-sm mb-4 font-medium"></p>
  

      <div class="flex items-start mb-6">
        <div class="flex items-center h-5">
          <input id="agreeRules" type="checkbox"
            class="w-4 h-4 text-indigo-600 bg-gray-100 border-gray-300 rounded focus:ring-indigo-500 focus:ring-2">
        </div>
        <label for="agreeRules" class="ml-2 text-sm text-gray-700">
          I have read and agree to the <a href="./rules-and-regulations" class="text-indigo-600 underline">rules and regulations</a>
        </label>
      </div>
      

      <button id="registerButton" disabled class="mt-6 bg-indigo-400 text-white px-4 py-2 rounded opacity-50 cursor-not-allowed transition">
        Register Now
      </button>

      <p id="thankYou" class="text-green-600 mt-4 hidden">Thanks for expressing your interest! Your email draft is now open.</p>
    </form>
  </main>

  <div id="footer"></div>

  <script>
    async function loadPartial(id, file) {
        const res = await fetch(file);
        const html = await res.text();
        document.getElementById(id).innerHTML = html;

        // Attach menu toggle behavior *after* header is injected
        // Re-run script after loading header
        if (id === "header") {
          const toggleButton = document.getElementById("menu-toggle");
          const menu = document.getElementById("mobile-menu");

          toggleButton?.addEventListener("click", (e) => {
            e.stopPropagation();
            menu?.classList.toggle("hidden");
          });

          document.addEventListener("click", (e) => {
            if (!menu?.contains(e.target) && !toggleButton?.contains(e.target)) {
              menu?.classList.add("hidden");
            }
          });
        }
      }

    const checkbox = document.getElementById("agreeRules");
    const button = document.getElementById("registerButton");

    checkbox.addEventListener("change", () => {
    if (checkbox.checked) {
        button.disabled = false;
        button.classList.remove("bg-indigo-400", "opacity-50", "cursor-not-allowed");
        button.classList.add("bg-indigo-600", "hover:bg-indigo-700");
    } else {
        button.disabled = true;
        button.classList.remove("bg-indigo-600", "hover:bg-indigo-700");
        button.classList.add("bg-indigo-400", "opacity-50", "cursor-not-allowed");
    }
    });


    loadPartial("header", "./shared/header.html");
    loadPartial("footer", "./shared/footer.html");

    // Load referral options from active-members.json
    let validReferrals = [];

    fetch("./active-members.json")
        .then(res => res.json())
        .then(data => {
        validReferrals = data.sort((a, b) => a.localeCompare(b));
        const referralList = document.getElementById("referralOptions");
        validReferrals.forEach(name => {
            const option = document.createElement("option");
            option.value = name;
            referralList.appendChild(option);
        });
        });

    document.getElementById("registerButton").addEventListener("click", (e) => {
        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const handicap = document.getElementById("handicap").value.trim();
        const referral = document.getElementById("referral").value.trim();
        const agree = document.getElementById("agreeRules").checked;
        const errorBox = document.getElementById("formError");
        const successBox = document.getElementById("formSuccess");

        errorBox.textContent = "";
        successBox.textContent = "";

        if (!name || !email || !handicap || !referral || !agree) {
        errorBox.textContent = "Please complete all fields and agree to the rules.";
        return;
        }

        if (!validReferrals.includes(referral)) {
        errorBox.textContent = "Referral name must match a current member from the list.";
        return;
        }

        const body = `Hi, I'd like to register for The Amatour. Here are my details:\n\nName: ${name}\nEmail: ${email}\nHandicap: ${handicap}\nReferred By: ${referral}`;
        const mailto = `mailto:info.theamateurstour@gmail.com?subject=New Registration&body=${encodeURIComponent(body)}`;

        // NEW (robust way to trigger email client)
        const tempLink = document.createElement("a");
        tempLink.href = mailto;
        tempLink.style.display = "none";
        document.body.appendChild(tempLink);
        tempLink.click();
        document.body.removeChild(tempLink);

        successBox.textContent = "Thank you for registering! Please check your email to send the message.";
        document.getElementById("registerForm").reset();
        document.getElementById("registerButton").disabled = true;

        setTimeout(() => {
        document.getElementById("registerButton").disabled = false;
        }, 3000);
    });
  </script>
</body>
</html>
