<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Player Details | The Amatour</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 p-6 md:p-12 font-sans">

  <div id="player-content">
    <h1 class="text-4xl font-bold mb-4" id="player-name">Loading...</h1>
    <p class="mb-8 text-gray-600" id="ghin"></p>

    <!-- Event Breakdown -->
    <div class="mb-10">
      <h2 class="text-2xl font-semibold mb-4">üìÖ Event Breakdown</h2>
      <div id="event-breakdown"></div>
    </div>

    <!-- Season Averages -->
    <div class="mb-10">
      <h2 class="text-2xl font-semibold mb-4">üìä Season Averages</h2>
      <table class="w-full text-left bg-white rounded shadow overflow-hidden">
        <thead class="bg-indigo-100">
          <tr>
            <th class="px-4 py-2">Gross</th>
            <th class="px-4 py-2">Net</th>
            <th class="px-4 py-2">Putts/Round</th>
            <th class="px-4 py-2">Fairways Hit (%)</th>
            <th class="px-4 py-2">GIR (%)</th>
          </tr>
        </thead>
        <tbody id="season-averages" class="text-gray-700"></tbody>
      </table>
    </div>

    <!-- Score Breakdown -->
    <div>
      <h2 class="text-2xl font-semibold mb-4">‚õ≥Ô∏è Scoring Breakdown</h2>
      <table class="w-full text-left bg-white rounded shadow overflow-hidden">
        <thead class="bg-indigo-100">
          <tr>
            <th class="px-4 py-2">Eagles</th>
            <th class="px-4 py-2">Birdies</th>
            <th class="px-4 py-2">Pars</th>
            <th class="px-4 py-2">Bogeys</th>
            <th class="px-4 py-2">Double+</th>
          </tr>
        </thead>
        <tbody id="score-breakdown" class="text-gray-700"></tbody>
      </table>
    </div>
  </div>

  <script>
    async function loadPlayerData() {
      const slug = new URLSearchParams(window.location.search).get("player");

      try {
        const response = await fetch("./statistics/individual.json");
        const players = await response.json();
        const player = players[slug];

        if (!player) throw new Error("Player not found");

        document.getElementById("player-name").textContent = player.name;
        document.getElementById("ghin").textContent = `GHIN: ${player.ghin}`;

        renderEvents(player.events);
        renderAverages(player.season_averages);
        renderBreakdown(player.score_breakdown);
      } catch (err) {
        document.getElementById("player-content").innerHTML = `<p class='text-red-600'>Failed to load player data.</p>`;
      }
    }

    function renderEvents(events) {
      const container = document.getElementById("event-breakdown");
      container.innerHTML = events.map(event => `
        <div class="mb-6">
          <h3 class="text-lg font-bold text-indigo-600">${event.event_name} ‚Äî <span class="text-sm font-normal text-gray-500">${event.date} | ${event.course}</span></h3>
          <table class="w-full mt-2 mb-4 text-sm bg-white rounded shadow overflow-x-auto">
            <thead class="bg-gray-100">
              <tr>
                ${event.holes.map((_, i) => `<th class="px-2 py-1">${i + 1}</th>`).join("")}
                <th class="px-2 py-1 font-semibold">Gross</th>
                <th class="px-2 py-1 font-semibold">Net</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                ${event.holes.map(score => `<td class="px-2 py-1 text-center">${score}</td>`).join("")}
                <td class="px-2 py-1 font-semibold text-center">${event.gross}</td>
                <td class="px-2 py-1 font-semibold text-center">${event.net}</td>
              </tr>
            </tbody>
          </table>
        </div>
      `).join("");
    }

    function renderAverages(avg) {
      document.getElementById("season-averages").innerHTML = `
        <tr>
          <td class="px-4 py-2">${avg.gross}</td>
          <td class="px-4 py-2">${avg.net}</td>
          <td class="px-4 py-2">${avg.putts_per_round}</td>
          <td class="px-4 py-2">${avg.fairways_hit_percent}%</td>
          <td class="px-4 py-2">${avg.greens_in_regulation_percent}%</td>
        </tr>`;
    }

    function renderBreakdown(scores) {
      document.getElementById("score-breakdown").innerHTML = `
        <tr>
          <td class="px-4 py-2">${scores.eagle}</td>
          <td class="px-4 py-2">${scores.birdie}</td>
          <td class="px-4 py-2">${scores.par}</td>
          <td class="px-4 py-2">${scores.bogey}</td>
          <td class="px-4 py-2">${scores.double_or_worse}</td>
        </tr>`;
    }

    window.addEventListener("DOMContentLoaded", loadPlayerData);
  </script>
</body>
</html>
