<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Event Details | The Amatour</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <div id="header"></div>

  <main class="max-w-5xl mx-auto px-6 py-10">
    <div id="eventDetails"></div>
  </main>

  <div id="footer"></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const slug = urlParams.get("event");

    // Placeholder for player name; replace with actual selection logic
    const playerName = localStorage.getItem("playerName") || "Your Name";

    Promise.all([
      fetch("./scheduling/events.json").then(res => res.json()),
      fetch("./statistics/individual.json").then(res => res.json())
    ]).then(([events, individuals]) => {
      const event = events.find(e => e.slug === slug);
      if (!event) {
        document.getElementById("eventDetails").innerHTML = "<p class='text-red-500'>Event not found.</p>";
        return;
      }

      const eventDate = new Date(event.date).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });

      const isPastEvent = new Date(event.date) < new Date();
      const emailBody = `Hi, I'd like to register for the ${event.name} event on ${eventDate}. My name is ${playerName}.`;
      const mailtoLink = `mailto:info.theamateurstour@gmail.com?subject=Registration for ${event.name} ${event.date}&body=${encodeURIComponent(emailBody)}`;

      const registeredPlayers = Array.isArray(event.registered_players) && event.registered_players.length > 0
        ? event.registered_players.map(name => `<li>${name}</li>`).join("")
        : "<li class='text-gray-500 italic'>No players have registered yet.</li>";
      const teeGroups = Array.isArray(event.tee_groups) && event.tee_groups.length > 0
        ? event.tee_groups.map((group, i) => `<p><strong>Group ${i + 1}:</strong> ${group.join(", ")}</p>`).join("")
        : "<p class='text-gray-500 italic'>Tee groups have not been assigned yet.</p>";

      const detailsHTML = `
        <div class="bg-white shadow rounded-lg p-6">
          <h1 class="text-3xl font-bold text-indigo-700 mb-2">${event.name}</h1>
          <p class="text-sm text-gray-600 mb-4">${eventDate} at ${event.venue}</p>

          <p class="mb-4">${event.description}</p>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6">
            <div>
              <h2 class="font-semibold text-lg mb-2">Event Info</h2>
              <ul class="text-gray-700 text-sm space-y-1">
                <li><strong>Entry Fee:</strong> $${event.entry_fee}</li>
                <li><strong>Total Par:</strong> ${event.par}</li>
                <li><strong>Total Distance:</strong> ${event.total_distance}</li>
                <li><strong>Tees:</strong> ${event.tees.M.tee_box} (Men), ${event.tees.W.tee_box} (Women)</li>
                <li><strong>Course Rating:</strong> ${event.tees.M.course_rating} (M), ${event.tees.W.course_rating} (W)</li>
                <li><strong>Slope Rating:</strong> ${event.tees.M.slope_rating} (M), ${event.tees.W.slope_rating} (W)</li>
                <li><strong>Winnings:</strong> $${event.winnings}</li>
                <li><a href="./rules-and-regulations" class="text-indigo-600 hover:underline">Rules and Regulations</a></li>
              </ul>
            </div>

            <div>
              <h2 class="font-semibold text-lg mb-2">Tee Times & Groups</h2>
              <p class="text-sm text-gray-700 mb-2"><strong>Tee Times:</strong> ${event.tee_times.length > 0 ? event.tee_times.join(", ") : "TBD"}</p>
              <div class="text-sm text-gray-700 space-y-1">${teeGroups}</div>
            </div>
          </div>

          <div class="mb-6">
            <h2 class="font-semibold text-lg mb-2">Registered Participants</h2>
            <ul class="text-sm text-gray-700 list-disc list-inside">
              ${registeredPlayers || "<li>No one registered yet.</li>"}
            </ul>
          </div>

          ${!isPastEvent ? `
            <a href="${mailtoLink}" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition">
              Register for Event
            </a>
          ` : ""}
        </div>
      `;

      document.getElementById("eventDetails").innerHTML = detailsHTML;
    });

    async function loadPartial(id, file) {
      const res = await fetch(file);
      const html = await res.text();
      document.getElementById(id).innerHTML = html;

      if (id === "header") {
        const toggle = document.getElementById("menu-toggle");
        const menu = document.getElementById("mobile-menu");
        if (toggle && menu) {
          toggle.addEventListener("click", () => {
            menu.classList.toggle("hidden");
          });
        }
      }
    }

    loadPartial("header", "./shared/header.html");
    loadPartial("footer", "./shared/footer.html");
  </script>
</body>
</html>
